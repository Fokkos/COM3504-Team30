<button
  type="button"
  class="hover-button flex items-center gap-2 rounded px-3 py-2 text-center font-bold"
  data-toggle="modal"
  data-target="#plantModal"
>
  Add Plant <span class="material-symbols-outlined"> library_add </span>
</button>

<div
  class="modal fixed left-0 top-0 flex h-full w-full items-center justify-center"
  id="plantModal"
  tabindex="-1"
  role="dialog"
>
  <div
    class="modal-overlay absolute h-full w-full bg-gray-900 opacity-50"
    data-close
  ></div>
  <div
    class="modal-container z-50 mx-auto w-5/6 overflow-y-auto rounded bg-background shadow-lg md:max-w-md"
  >
    <div class="modal-content px-6 py-4">
      <div class="mb-4 flex items-center justify-between">
        <h5 class="modal-title text-xl font-semibold">
          Create a new plant sighting
        </h5>
        <button
          class="close-modal flex justify-center rounded border border-gray-300 bg-[--background] hover:bg-red-400"
          aria-label="Close modal"
          title="Close modal"
          data-close
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form
          action="/create-plant"
          method="POST"
          enctype="multipart/form-data"
          id="createPlantForm"
        >
          <div class="form-group mb-4">
            <label for="name" class="block text-text">Name</label>
            <input
              type="text"
              class="form-input mt-1 block w-full rounded border border-gray-300 bg-[--background-light] pl-2 text-text"
              id="name"
              name="name"
              maxlength="40"
              required
            />
          </div>
          <div class="form-group mb-4">
            <label for="description" class="block text-text">Description</label>
            <textarea
              type="textarea"
              class="form-input mt-1 block w-full resize-none rounded border border-gray-300 bg-[--background-light] pl-2 text-text"
              id="description"
              name="description"
              rows="3"
              maxlength="256"
              required
            ></textarea>
          </div>
          <div class="form-group mb-4">
            <label for="dateTimeSeen" class="block text-text">Time seen</label>
            <input
              type="datetime-local"
              id="dateTimeSeen"
              name="dateTimeSeen"
              class="form-input mt-1 block w-full rounded border border-gray-300 bg-[--background-light] pl-2 text-text"
            />
          </div>
          <div class="form-group mb-4">
            <label for="size" class="block text-text">Size (cm)</label>
            <input
              type="number"
              class="form-input mt-1 block w-full rounded border border-gray-300 bg-[--background-light] pl-2 text-text"
              id="size"
              name="size"
              min="0"
              value="0"
              step=".01"
              required
            />
          </div>
          <!-- Select -->
          <div class="form-group mb-4">
            <label for="sunExposure" class="block text-text"
              >Sun Exposure</label
            >
            <select
              id="sunExposure"
              name="sunExposure"
              class="form-input block w-full rounded-lg border border-gray-300 bg-[--background-light] p-2.5 text-sm text-text focus:border-[--background-hover] focus:ring-[--background]"
            >
              <option>None</option>
              <option>Partial</option>
              <option>Full</option>
            </select>
          </div>

          <div class="form-group mb-4">
            <label for="colour" class="block text-text">Plant Colour</label>
            <input
              type="color"
              name="colour"
              class="form-input block h-10 w-14 cursor-pointer rounded border border-gray-300 bg-[--background-light] p-1 text-text"
              id="hs-color-input"
              value="#2d5936"
              title="Select plant colour"
            />
          </div>

          <!-- Checkboxes -->
          <!-- In checkboxes: hasFlowers, hasLeaves & sunExposure -->
          <!-- TODO change color of selected checkbox to --primary -->
          <label for="properties" class="block text-text">Properties</label>
          <div id="properties" class="form-group mb-4 flex justify-between">
            <div class="mb-2 flex items-center">
              <input
                id="hasFlowers"
                name="hasFlowers"
                type="checkbox"
                value="true"
                class="form-input focus:primary-hover h-4 w-4 rounded border-text-hover bg-text text-primary"
              />
              <label for="hasFlowers" class="ms-2 text-sm font-medium text-text"
                >Flowers</label
              >
            </div>
            <div class="mb-2 flex items-center">
              <input
                id="hasLeaves"
                name="hasLeaves"
                type="checkbox"
                value="true"
                class="form-input focus:primary-hover h-4 w-4 rounded border-text-hover bg-text text-primary"
              />
              <label for="hasLeaves" class="ms-2 text-sm font-medium text-text"
                >Leaves</label
              >
            </div>
            <div class="mb-2 flex items-center">
              <input
                id="hasFruit"
                name="hasFruit"
                type="checkbox"
                value="true"
                class="form-input focus:primary-hover h-4 w-4 rounded border-text-hover bg-text text-primary"
              />
              <label for="hasFruit" class="ms-2 text-sm font-medium text-text"
                >Fruit</label
              >
            </div>
            <div class="mb-2 flex items-center">
              <input
                id="hasSeeds"
                name="hasSeeds"
                type="checkbox"
                value="true"
                class="form-input focus:primary-hover h-4 w-4 rounded border-text-hover bg-text text-primary"
              />
              <label for="hasSeeds" class="ms-2 text-sm font-medium text-text"
                >Seeds</label
              >
            </div>
          </div>
          <div class="form-group mb-4">
            <label class="block text-text" for="file_input">Upload Image</label>
            <input
              class="file:form-input file:hover-button w-full cursor-pointer file:rounded file:px-4 file:py-2 file:font-bold"
              id="image"
              name="image"
              type="file"
              aria-describedby="file_input_help"
              accept="image/png, image/jpeg"
            />
          </div>
          <div class="form-group mb-4">
            <button class="form-input hover-button rounded px-4 py-2 font-bold" type="button" onclick="getLocation()">Get Location</button>
            <br><br>
            <label for="latitude">Latitude:</label>
            <input
              type="text"
              id="latitude"
              name="latitude"
              class="form-input mt-1 block w-full rounded border border-gray-300 bg-[--background-light] pl-2 text-text"
              required
              readonly
            >
            <label for="longitude">Longitude:</label>
            <input
              type="text"
              id="longitude"
              name="longitude"
              class="form-input mt-1 block w-full rounded border border-gray-300 bg-[--background-light] pl-2 text-text"
              required
              readonly
            >
          </div>
          <button
            id="submitButton"
            type="submit"
            class="form-input hover-button rounded px-4 py-2 font-bold"
            disabled
          >
            Submit
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('[data-toggle="modal"]').forEach((btn) => {
    btn.addEventListener('click', function () {
      let modalId = btn.getAttribute('data-target');
      document.querySelector(modalId).classList.toggle('active');
    });
  });

  document.querySelectorAll('[data-close]').forEach((btn) => {
    btn.addEventListener('click', function () {
      let modal = btn.closest('.modal');
      modal.classList.remove('active');
    });
  });

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      alert("Geolocation is not supported by this browser.");
    }
  }

  function showPosition(position) {
    document.getElementById("latitude").value = position.coords.latitude;
    document.getElementById("longitude").value = position.coords.longitude;
    // Enable the submit button once the geolocation is obtained
    document.getElementById("submitButton").disabled = false;
  }
</script>
